<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <title>Etiqueta PPLB - Argox 203 DPI</title>

    <style>
      body {
        font-family: Arial, sans-serif;
        background: #f4f6f8;
        padding: 40px;
      }

      .card {
        background: #fff;
        max-width: 480px;
        margin: auto;
        padding: 24px;
        border-radius: 8px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
      }

      h2 {
        text-align: center;
        margin-top: 0;
      }

      label {
        display: block;
        margin-top: 10px;
        font-weight: bold;
      }

      input {
        width: 100%;
        padding: 7px;
        margin-top: 4px;
        font-size: 14px;
      }

      button {
        width: 100%;
        margin-top: 16px;
        padding: 10px;
        font-size: 15px;
        cursor: pointer;
      }

      #status {
        text-align: center;
        font-weight: bold;
        margin-bottom: 10px;
      }
    </style>
  </head>

  <body>
    <div class="card">
      <h2>Etiqueta PPLB</h2>

      <p id="status">ðŸ”´ Desconectado</p>
      <button id="connectBtn">Conectar QZ Tray</button>

      <label>Tipo de Montagem</label>
      <input id="tipoMontagem" placeholder="LIVRE-DURA-LIVRE" />

      <label>Marca</label>
      <input id="marca" placeholder="LACOSTE" />

      <label>CÃ³digo do Item</label>
      <input id="codigoItem" placeholder="135667" />

      <label>Modelo</label>
      <input id="modelo" placeholder="REC" />

      <label>Cor</label>
      <input id="cor" placeholder="002" />

      <label>Tamanho da ArmaÃ§Ã£o</label>
      <input id="tamanho" placeholder="54" />

      <label>PreÃ§o de Venda</label>
      <input id="preco" placeholder="783,00" />

      <button id="printBtn" disabled>Imprimir Etiqueta</button>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/qz-tray@2.2.4/qz-tray.js"></script>

    <script>
      const statusEl = document.getElementById("status");
      const connectBtn = document.getElementById("connectBtn");
      const printBtn = document.getElementById("printBtn");

      const tipoMontagemEl = document.getElementById("tipoMontagem");
      const marcaEl = document.getElementById("marca");
      const codigoItemEl = document.getElementById("codigoItem");
      const modeloEl = document.getElementById("modelo");
      const corEl = document.getElementById("cor");
      const tamanhoEl = document.getElementById("tamanho");
      const precoEl = document.getElementById("preco");

      /* CERTIFICATE */
      qz.security.setCertificatePromise(function (resolve) {
        resolve(`-----BEGIN CERTIFICATE-----
MIIECzCCAvOgAwIBAgIGAZtQmWp1MA0GCSqGSIb3DQEBCwUAMIGiMQswCQYDVQQG
EwJVUzELMAkGA1UECAwCTlkxEjAQBgNVBAcMCUNhbmFzdG90YTEbMBkGA1UECgwS
UVogSW5kdXN0cmllcywgTExDMRswGQYDVQQLDBJRWiBJbmR1c3RyaWVzLCBMTEMx
HDAaBgkqhkiG9w0BCQEWDXN1cHBvcnRAcXouaW8xGjAYBgNVBAMMEVFaIFRyYXkg
RGVtbyBDZXJ0MB4XDTI1MTIyMzEzNDMxMFoXDTQ1MTIyMzEzNDMxMFowgaIxCzAJ
BgNVBAYTAlVTMQswCQYDVQQIDAJOWTESMBAGA1UEBwwJQ2FuYXN0b3RhMRswGQYD
VQQKDBJRWiBJbmR1c3RyaWVzLCBMTEMxGzAZBgNVBAsMElFaIEluZHVzdHJpZXMs
IExMQzEcMBoGCSqGSIb3DQEJARYNc3VwcG9ydEBxei5pbzEaMBgGA1UEAwwRUVog
VHJheSBEZW1vIENlcnQwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQCf
AaJdlLxlGgxJWPVcoCK1DQdhk2ksusmDRDgvglqdteFgs2gqmf5527FdiPR5Z9XH
wyxa4NdAj1iau7OCMJhICgJzm30EqEqPgQyMDOAfbXHneER3yBXx1Z0R2qSz+J9R
D+KgaPqi6u6uQuXTyuUh5wJtYZO0+If6mJSjYH6Vj7e2zSrA67js7UALAqLU7mkI
YyOfu9IansNoQj3lRmqSwTptvYjbzd+Mt8CrmBMEeekLkVMvZTAuDcRTzD3GfvUc
6VqSrpDsJSVV0x3tglq5MUWNxG4I6cGNhWJlkhyw6S8JRkqymMOD3hMxfNLaBCAP
g6KzMUNOMxrSgRawXLIJAgMBAAGjRTBDMBIGA1UdEwEB/wQIMAYBAf8CAQEwDgYD
VR0PAQH/BAQDAgEGMB0GA1UdDgQWBBR4DRQyE1WqL7H7i9UeF3hJ8DVL2jANBgkq
hkiG9w0BAQsFAAOCAQEAcm2KuZHwuPjMmLxWonVeuPTUeqc8aYy35HuzikytRYNG
TEmIYq7cMst8866jFJHKmfPq2Z5du5zAamlUrYkcafQwqyqqLLlcUTvuiwQ7HUFW
FF/zeprG+xMMyVQRimalWN1Y3ObSGlfeWps1Jc+5AkrB9zUkw/tMbURhIIJiSvNK
zLiB9VKFVCvDJl+y8ECDOIhjWRC97b9FjNKcVlVFHz3C0IInMz/NAp06zokKgkN1
SBDfK47MUCw/9Ol3ZQyuvLikWsV9vSWs6FJgIRoFuiVQx3taIBKqPHiZgTH3KMrH
vi0RmfMdqjovIJRYfGfLKGHH3mmvkG2DyyYjsRE+Iw==
-----END CERTIFICATE-----`);
      });

      qz.security.setSignatureAlgorithm("SHA512");
      qz.security.setSignaturePromise(() => (resolve) => resolve());

      /* CONNECT */
      connectBtn.onclick = async () => {
        try {
          statusEl.innerText = "ðŸŸ¡ Conectando...";
          await qz.websocket.connect({
            usingSecure: true,
            port: { secure: [8181] },
          });
          statusEl.innerText = "ðŸŸ¢ Conectado ao QZ Tray";
          printBtn.disabled = false;
        } catch (e) {
          statusEl.innerText = "ðŸ”´ Erro ao conectar";
          console.error(e);
        }
      };

      /* PRINT */
      printBtn.onclick = async () => {
        const tipo = tipoMontagemEl.value || "LIVRE-DURA-LIVRE";
        const marca = marcaEl.value || "LACOSTE";
        const codigo = codigoItemEl.value || "";
        const modelo = modeloEl.value || "REC";
        const cor = corEl.value || "002";
        const tamanho = tamanhoEl.value || "54";
        const preco = precoEl.value || "";

        if (!codigo || !preco) {
          alert("CÃ³digo e preÃ§o sÃ£o obrigatÃ³rios");
          return;
        }

        const printer = await qz.printers.find("Argox");
        const config = qz.configs.create(printer, { forceRaw: true });

        const raw = `\x02n
                      \x02M0800
                      \x02L
                      D11
                      191100000350030${tipo}
                      191100000650050${codigo}
                      121100000050030${marca} ${modelo}
                      121100000050100${codigo}
                      121100000450100R$ ${preco}
                      121100000050210${cor}
                      1211000000502100${tamanho}
                      121100000450210R$ ${preco}
                      Q0001
                      E
                      `;

        await qz.print(config, [raw]);
        statusEl.innerText = "âœ… Etiqueta impressa!";

        setTimeout(() => {
          statusEl.innerText = "ðŸŸ¢ Conectado ao QZ Tray";
        }, 2000);
      };
    </script>
  </body>
</html>
